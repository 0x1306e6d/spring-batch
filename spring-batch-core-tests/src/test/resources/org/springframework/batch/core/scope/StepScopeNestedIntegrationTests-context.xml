<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="step1" class="org.springframework.batch.core.scope.TestStep">
		<property name="collaborator">
			<bean id="bar" class="org.springframework.batch.core.scope.TestDisposableCollaborator" scope="step">
				<property name="name" value="#{stepExecutionContext['bar']}" />
				<property name="parent" ref="parent" />
			</bean>
		</property>
	</bean>

	<bean id="parent" class="org.springframework.batch.core.scope.TestDisposableCollaborator">
		<property name="name" value="foo" />
	</bean>

	<bean id="step2" class="org.springframework.batch.core.scope.TestStep">
		<property name="collaborator" ref="spam" />
	</bean>

	<bean id="spam" class="org.springframework.batch.core.scope.TestDisposableCollaborator" scope="step">
		<property name="name" value="#{stepExecutionContext['spam']}" />
		<property name="parent">
			<bean id="bucket" class="org.springframework.batch.core.scope.TestDisposableCollaborator" scope="singleton">
				<property name="name" value="#{properties['parent.name']}" />
			</bean>
		</property>
	</bean>
	
	<bean id="step3" class="org.springframework.batch.core.scope.TestStep">
		<property name="collaborator" ref="maps" />
	</bean>

	<bean id="maps" class="org.springframework.batch.core.scope.TestDisposableCollaborator" scope="step">
		<property name="name" value="#{stepExecutionContext['maps']}" />
		<property name="parent">
			<bean id="rab" class="org.springframework.batch.core.scope.TestDisposableCollaborator">
				<property name="name" value="#{stepExecutionContext['rab']}" />
			</bean>
		</property>
	</bean>
	
	<util:properties id="properties">
		<prop key="parent.name">bucket</prop>
	</util:properties>

	<aop:aspectj-autoproxy />
	<bean class="org.springframework.batch.core.scope.context.StepScopeManager" />
	<bean class="org.springframework.batch.core.scope.StepScope" />

</beans>